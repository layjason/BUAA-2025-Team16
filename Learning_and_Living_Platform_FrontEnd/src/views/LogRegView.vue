<template>
<div style="font-family: poppins,sans-serif; background-color: #669eff;">
    <header class="header">
    <nav class="navbar">
        <a @click="router.push('/')">‰∏ªÈ°µ</a>
        <v-dialog v-model="showAbout" class="overlay">
            <template v-slot:activator="{ props }">
                <a v-bind="props">ÂÖ≥‰∫é</a>
            </template>
            <div class="dialog-container" @click="showAbout = false">
                <div class="dialog" style="flex-direction: row; width: 1000px;">
                </div>
            </div>
        </v-dialog>
        <v-dialog v-model="showContact" class="overlay">
            <template v-slot:activator="{ props }">
                <a v-bind="props">ËÅîÁ≥ªÊàë‰ª¨</a>
            </template>
            <div class="dialog-container" @click="showContact = false">
                <div class="dialog" style="flex-direction: row; width: 1000px;">
                    <div class="about-colunm">
                        <v-avatar size="80">
                            <v-img src="https://learning-and-living.oss-cn-beijing.aliyuncs.com/start/AkashiSensei.jpg"/>
                        </v-avatar>
                        <div class="title-dark" style="margin-top: 30px;">AkashiSensei</div>
                        <div class="text-dark" style="margin-top: 2px;">ÂàòÁõäÊ¥≤</div>
                        <div class="text-dark" style="">20374249@buaa.edu.cn</div>
                    </div>

                    <div class="about-colunm">
                        <v-avatar size="80">
                            <v-img src="https://learning-and-living.oss-cn-beijing.aliyuncs.com/start/99956963.jpg"/>
                        </v-avatar>
                        <div class="title-dark" style="margin-top: 30px;">MAKIMA</div>
                        <div class="text-dark" style="margin-top: 2px;">Áéã‰∂ÆÂ†É</div>
                        <div class="text-dark" style="">20374126@buaa.edu.cn</div>
                    </div>

                    <div class="about-colunm">
                        <v-avatar size="80">
                            <v-img src="https://learning-and-living.oss-cn-beijing.aliyuncs.com/start/78774953.jpg"/>
                        </v-avatar>
                        <div class="title-dark" style="margin-top: 30px;">pcpas</div>
                        <div class="text-dark" style="margin-top: 2px;">Âº†Ê≠£Â•á</div>
                        <div class="text-dark" style="">20374265@buaa.edu.cn</div>
                    </div>

                    <div class="about-colunm">
                        <v-avatar size="80">
                            <v-img src="https://learning-and-living.oss-cn-beijing.aliyuncs.com/start/111098017.jpg"/>
                        </v-avatar>
                        <div class="title-dark" style="margin-top: 30px;">Cheap-Cheer</div>
                        <div class="text-dark" style="margin-top: 2px;">Èôà‰πãÊµ©</div>
                        <div class="text-dark" style="">20374151@buaa.edu.cn</div>
                    </div>

                    <div class="about-colunm">
                        <v-avatar size="80">
                            <v-img src="https://learning-and-living.oss-cn-beijing.aliyuncs.com/start/95218018.jpg"/>
                        </v-avatar>
                        <div class="title-dark" style="margin-top: 30px;">Cubeying</div>
                        <div class="text-dark" style="margin-top: 2px;">Ê¢ÅË∑ûÊñπ</div>
                        <div class="text-dark" style="">20374090@buaa.edu.cn</div>
                    </div>
                </div>
            </div>
        </v-dialog>
        <v-dialog v-model="showHelp" class="overlay">
            <template v-slot:activator="{ props }">
                <a v-bind="props">Â∏ÆÂä©</a>
            </template>
            <div class="dialog-container" @click="showHelp = false">
                <div class="dialog" @click.stop="" style="padding: 0px; overflow: hidden;">
                    <div><GuidePanel :guideEntry="helpEntry" /></div>
                </div>
            </div>
        </v-dialog>
    </nav>
    </header>
    <!-- LOGIN FORM CREATION -->
    <div :class="['backgroundLogin', (auth == 'admin') ? 'background-night' : 'background-day']"></div>
    <div :class="['container', (auth == 'admin') ? 'background-night' : 'background-day']">
        <div class="item">
            <h2 class="logo"><i class='bx bxl-xing'></i>Leaning and Living Platform</h2>
            <div class="text-item">
                <h2>Ê¨¢Ëøé!</h2>
                <h2 style="margin-top: 5px;">‚ÄúÊòìË®Ä‚ÄùÂ≠¶‰π†ÁîüÊ¥ªÂπ≥Âè∞</h2>
                <p>Enjoy your life and study hard.</p>
                <div class="social-icon">
                    <a href="https://github.com/BUAA-SEF-Team15/Learning_and_Living_Platform_FrontEnd"><Icon type="logo-github" /></a>
                </div>
            </div>
        </div>
        <div ref="loginSecRef" class="login-section">
            
            <div class="form-box login">
                <form action="">
                    <h2>ÁôªÂΩï</h2>
                    <var-input 
                    style="margin-top: 20px;"
                    v-model="loginForm.idOrEmail"
                    text-color="white"
                    placeholder="ID or Email" 
                    focus-color="white"
                    blur-color="white"
                    >
                    <template #append-icon>
                        <var-icon name="account-circle" />
                    </template>
                    </var-input>
                    <var-input 
                    type="password"
                    v-model="loginForm.password"
                    style="margin-top: 30px;"
                    placeholder="Password" 
                    text-color="white"
                    focus-color="white"
                    blur-color="white"
                    >
                    <template #append-icon>
                        <Icon type="md-lock" />
                    </template>
                    </var-input>

                    <div class="remember-password" style="margin-bottom: 10px;">
                        <v-radio-group inline 
                        v-model="auth">
                            <v-radio label="User" value="user" />
                            <v-radio label="Admin" value="admin" />
                        </v-radio-group>
                        <v-btn
                            @click="jump2Forget()"
                            style="height: 20px;margin-top: 10px;"
                            variant="text"
                            >ÂøòËÆ∞ÂØÜÁ†Å
                        </v-btn>
                    </div>
                    <var-button 
                    @click="login"
                    text  
                    color="linear-gradient(to right, #69dbaa, #3a7afe)"
                    style="width: 100%;height: 45px;font-size: 16px;"
                    type="primary">
                    Á°ÆËÆ§ÁôªÂΩï
                    </var-button>
                    <div class="create-account">
                        <p>Ê≤°ÊúâË¥¶Êà∑ÔºüÂàõÂª∫Êñ∞ÁöÑÁî®Êà∑Ë¥¶Êà∑„ÄÇ
                            <v-btn
                            @click="jump2Register()"
                            style="height: 20px;"
                            variant="text"
                            >Ê≥®ÂÜå</v-btn>
                        </p>
                    </div>
                </form>
            </div>
            <div v-if="forgetPass" class="form-box register">
                <form action="">
                    <h2>ÂøòËÆ∞ÂØÜÁ†Å</h2>
                    <var-input 
                    style="margin-top: 20px;"
                    placeholder="Email" 
                    text-color="white"
                    focus-color="white"
                    blur-color="white"
                    v-model="forgetForm.email"
                    >
                    <template #append-icon>
                        <Icon type="md-mail" />
                    </template>
                    </var-input>
                    <div class="remember-password">
                        <label for="">‰Ω†ÁöÑÊñ∞ÂØÜÁ†ÅÂ∞Ü‰ºöÂèëÈÄÅÂà∞‰Ω†ÁöÑÈÇÆÁÆ±ÔºåËØ∑Ê≥®ÊÑèÊü•Êî∂</label>
                    </div>

                    <var-button 
                    v-if="waitForget"
                    text
                    color="linear-gradient(to right, #69dbaa, #3a7afe)"
                    style="width: 100%;height: 45px;font-size: 16px;"
                    >
                    Please wait
                    </var-button>
                    <var-button 
                    v-else
                    text  
                    color="linear-gradient(to right, #69dbaa, #3a7afe)"
                    style="width: 100%;height: 45px;font-size: 16px;"
                    @click = "getPassword()"
                    >
                    Get it Back!
                </var-button>

                    <div class="create-account">
                        <p>ËøîÂõûÁôªÈôÜ üëâ
                            <v-btn
                            @click="jump2LoginFromForget()"
                            style="height: 20px;"
                            variant="text"
                            >ÁôªÂΩï</v-btn>
                        </p>
                    </div>
                </form>
            </div>
            <div v-else class="form-box register">
                <form action="">
                    <h2>Ê≥®ÂÜå</h2>
                    <var-input 
                    style="margin-top: 20px;"
                    v-model="registerForm.email"
                    placeholder="Email" 
                    text-color="white"
                    focus-color="white"
                    blur-color="white"
                    >
                    <template #append-icon>
                        <Icon type="md-mail" />
                    </template>
                    </var-input>
                    <var-input 
                    type="password"
                    v-model="registerForm.password"
                    style="margin-top: 20px;"
                    placeholder="Password" 
                    text-color="white"
                    focus-color="white"
                    blur-color="white"
                    >
                    <template #append-icon>
                        <Icon type="md-unlock" />
                    </template>
                    </var-input>
                    <var-input 
                    type="password"
                    v-model="registerForm.password_repeat"
                    style="margin-top: 20px;"
                    placeholder="Repeat Password" 
                    text-color="white"
                    focus-color="white"
                    blur-color="white"
                    >
                    <template #append-icon>
                        <Icon type="md-lock" />
                    </template>
                    </var-input>
                    <div class="remember-password">
                        <label for=""><input type="checkbox" v-model="accept">ÊàëÂêåÊÑè
                            <v-dialog v-model="showStatement" class="overlay">
                                <template v-slot:activator="{ props }">
                                    <span v-bind="props" class="clickable">„ÄäÊòìË®ÄÂ≠¶‰π†ÁîüÊ¥ªÂπ≥Âè∞Êù°Ê¨æ„Äã</span>
                                </template>
                                <div class="dialog-container" @click="showStatement = false">
                                    <div class="dialog" style="padding-bottom: 50px;">
                                        <div class="sta-title">ÊòìË®Ä‰ΩøÁî®Êù°Ê¨æ</div>
                                        <div class="sta-section">
                                            <div class="sta-section-title">1. Áî®Êà∑Êù°Ê¨æ</div>
                                            <div class="sta-content">1.1 ÊÇ®Âú®Ê≥®ÂÜåÊó∂Â∫îÂΩìÊèê‰æõÁúüÂÆû„ÄÅÂáÜÁ°Æ„ÄÅÊúÄÊñ∞„ÄÅÂÆåÊï¥ÁöÑ‰∏™‰∫∫‰ø°ÊÅØ„ÄÇÂ¶ÇÊûúÂõ†Ê≥®ÂÜå‰ø°ÊÅØ‰∏çÁúüÂÆûËÄåÂºïËµ∑ÁöÑÈóÆÈ¢òÔºåÁî±Áî®Êà∑Ëá™Ë°åÊâøÊãÖÁõ∏Â∫îÁöÑÂêéÊûú„ÄÇ</div>
                                            <div class="sta-content">1.2 Áî®Êà∑ÈúÄÂ¶•ÂñÑ‰øùÁÆ°Ê≥®ÂÜåË¥¶Âè∑‰ø°ÊÅØÂíåÂØÜÁ†ÅÔºå‰∏çÂæóÂ∞ÜË¥¶Âè∑‰ø°ÊÅØÈÄèÈú≤Áªô‰ªñ‰∫∫ÔºåÂõ†Áî®Êà∑‰øùÁÆ°‰∏çÂñÑÂØºËá¥Ë¥¶Âè∑‰∏¢Â§±ÁöÑÔºåÁî±Áî®Êà∑Ëá™Ë°åÊâøÊãÖ„ÄÇ</div>
                                            <div class="sta-content">1.3 Áî®Êà∑‰∏çÂæóÂà©Áî®Êú¨Âπ≥Âè∞ËøõË°åËøùÊ≥ïË°å‰∏∫ÔºåÂåÖÊã¨‰ΩÜ‰∏çÈôê‰∫éÂèëÂ∏ÉËøùÊ≥ï‰ø°ÊÅØ„ÄÅ‰æµÂÆ≥‰ªñ‰∫∫ÊùÉÁõäÁ≠â„ÄÇ</div>
                                        </div>
                                        <div class="sta-section">
                                            <div class="sta-section-title">2. Âπ≥Âè∞‰ΩøÁî®ËßÑÂàô</div>
                                            <div class="sta-content">2.1 Áî®Êà∑Âú®‰ΩøÁî®Êú¨Âπ≥Âè∞ÁöÑÊâÄÊúâÊúçÂä°Êó∂ÂøÖÈ°ªÈÅµÂÆàÁõ∏ÂÖ≥Ê≥ïÂæãÊ≥ïËßÑÔºå‰∏çÂæóÂú®Êú¨Âπ≥Âè∞ËøõË°åÂèëÂ∏É„ÄÅ‰º†Êí≠ÊàñËÄÖÂÖ∂‰ªñÊñπÂºè‰ΩøÁî®Âê´Êúâ‰ª•‰∏ãÂÜÖÂÆπÁöÑ‰ø°ÊÅØÔºö</div>
                                            <div class="sta-content">- ÂèçÂØπÂÆ™Ê≥ïÊâÄÁ°ÆÂÆöÁöÑÂü∫Êú¨ÂéüÂàôÁöÑÔºõ</div>
                                            <div class="sta-content">- Âç±ÂÆ≥ÂõΩÂÆ∂ÂÆâÂÖ®ÔºåÊ≥ÑÈú≤ÂõΩÂÆ∂ÁßòÂØÜÔºåÈ¢†Ë¶ÜÂõΩÂÆ∂ÊîøÊùÉÔºåÁ†¥ÂùèÂõΩÂÆ∂Áªü‰∏ÄÁöÑÔºõ</div>
                                            <div class="sta-content">- ÊçüÂÆ≥ÂõΩÂÆ∂Ëç£Ë™âÂíåÂà©ÁõäÁöÑÔºõ</div>
                                            <div class="sta-content">- ÁÖΩÂä®Ê∞ëÊóè‰ªáÊÅ®„ÄÅÊ∞ëÊóèÊ≠ßËßÜÔºåÁ†¥ÂùèÊ∞ëÊóèÂõ¢ÁªìÁöÑÔºõ</div>
                                            <div class="sta-content">- Á†¥ÂùèÂõΩÂÆ∂ÂÆóÊïôÊîøÁ≠ñÔºåÂÆ£Êâ¨ÈÇ™ÊïôÂíåÂ∞ÅÂª∫Ëø∑‰ø°ÁöÑÔºõ</div>
                                            <div class="sta-content">- Êï£Â∏ÉË∞£Ë®ÄÔºåÊâ∞‰π±Á§æ‰ºöÁß©Â∫è„ÄÇ</div>
                                        </div>
                                    </div>
                                </div>
                            </v-dialog>
                        </label>
                    </div>
                    <var-button 
                    @click="register()"
                    text  
                    color="linear-gradient(to right, #69dbaa, #3a7afe)"
                    style="width: 100%;height: 45px;font-size: 16px;"
                    type="primary">Á°ÆËÆ§Ê≥®ÂÜå</var-button>
                    <div class="create-account">
                        <p>Â∑≤ÁªèÊúâÊòìË®ÄÂπ≥Âè∞ÁöÑÁî®Êà∑Ë¥¶Êà∑‰∫ÜÔºü
                            <v-btn
                            @click="jump2Login()"
                            style="height: 20px;margin-bottom: 3px;"
                            variant="text"
                            >ÁôªÂΩï</v-btn>
                        </p>
                    </div>
                </form>
            </div>
        
        </div>
        <v-dialog
            v-model="isLogin"
            persistent
            width=48%
            height=30%
            >
            <v-card color="blue" >
                <div style="min-width: 320px;min-width: 200px;">
                    <v-card-text>
                    ‰Ω†Â∑≤ÁªèÊàêÂäüÁôªÈôÜ‰∫ÜÔºÅ
                    <v-progress-linear
                        indeterminate
                        color="white"
                        class="mb-0"
                    ></v-progress-linear>
                    </v-card-text>
                </div>
            </v-card>
        </v-dialog>
    </div>
    <!-- <v-dialog v-model="showDelete" :persistent="isDeleting" class="overlay">
        <div class="dialog-container">
            <div class="dialog">
                <div class="title-dark" >ÊòØÂê¶Á°ÆËÆ§Âà†Èô§ËµÑÊ∫êÔºü</div>
                <div class="text-large-dark" style="margin-top: 8px;">
                    ÊÇ®Ê≠£Âú®Âà†Èô§ËµÑÊ∫êÔºö<span style="font-weight: bolder;">{{resData.title}}</span>„ÄÇÊòØÂê¶ÁªßÁª≠Ôºü
                </div>
                <div style="display: flex; flex-direction: row; justify-content: end; margin-top: 15px;">
                    <v-btn variant="tonal" :disabled="isDeleting" style="margin-right: 5px;" title="ÂèñÊ∂à" @click.stop="showDelete=false">ÂèñÊ∂à</v-btn>
                    <v-btn variant="flat" :loading="isDeleting" color="red" style="margin-left: 5px;" @click.stop="tryDelete" title="Âà†Èô§ËµÑÊ∫ê">Á°ÆËÆ§Âà†Èô§</v-btn>
                </div>
            </div>
        </div>
    </v-dialog> -->
</div> 
</template>

<style>

@import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,300;0,400;0,500;1,500&display=swap');
/* body{
    height: 100vh;
    width: 100%;
    background: #000;
} */
.backgroundLogin{
    background-position: center;
    background-size:cover ;
    height: 100vh;
    width: 100%;
    filter: blur(10px);
}
.background-day{
    background: url(https://learning-and-living.oss-cn-beijing.aliyuncs.com/test/39578544_p21.jpg) no-repeat;
}
.background-night{
    background: url(https://learning-and-living.oss-cn-beijing.aliyuncs.com/test/39578544_p20.jpg) no-repeat;
}
.header{
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    padding: 25px 13%;
    background: transparent;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 100;

}
.navbar a{
    position: relative;
    font-size: 16px;
    color: #fff;
    margin-right: 30px;
    text-decoration: none;
}
.navbar a::after{
    content: "";
    position: absolute;
    left: 0;
    width: 100%;
    height: 2px;
    background: #fff;
    bottom: -5px;
    border-radius: 5px;
    transform: translateY(10px);
    opacity: 0;
    transition: .5s ease;
}
.navbar a:hover:after{
    transform: translateY(0);
    opacity: 1;
}
.search-bar{
    width: 250px;
    height: 45px;
    background-color: transparent;
    border: 2px solid #fff;
    border-radius: 6px;
    display: flex;
    align-items: center;
}
.search-bar input{
    width: 100%;
    background-color: transparent;
    border: none;
    outline: none;
    color: #fff;
    font-size: 16px;
    padding-left: 10px;
}
.search-bar button{
    width: 40px;
    height: 100%;
    background: transparent;
    outline: none;
    border: none;
    color: #fff;
    cursor: pointer;
}
.search-bar input::placeholder{
    color: #fff;
}
.search-bar button i{
    font-size: 22px;
}
.container{
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%,-50%);
    width: 75%;
    min-height: 500px;
    max-height: 550px;
    margin-top: 20px;
    background-position: center;
    background-size:cover ;
    border-radius: 20px;
    overflow: hidden;
}
.item{
    position: absolute;
    top: 0;
    left: 0;
    width: 58%;
    height: 100%;
    color: #fff;
    background: transparent;
    padding: 80px;
    display: flex;
    justify-content: space-between;
    flex-direction: column;
}
.item .logo{
    color: #fff;
    font-size: 30px;
}
.text-item h2{
    font-size: 40px;
    line-height: 1;
}
.text-item p{
    font-size: 16px;
    margin: 20px 0;
}
.social-icon a i{
    color: #fff;
    font-size: 24px;
    margin-left: 10px;
    cursor: pointer;
    transition: .5s ease;
}
.social-icon a:hover i{
    transform: scale(1.2);
}
.container .login-section{
    position: absolute;
    top: 0;
    right: 0;
    width: calc(100% - 58%);;
    min-width: 400px;
    max-width: 500px;
    height: 100%;
    color: #fff;
    backdrop-filter: blur(10px);
}

.login-section .form-box{
    position: absolute;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
    
}
.login-section .form-box.register{
    transform: translateX(430px);
    transition: transform .6s ease;
    transition-delay: 0s;
}
.login-section.active .form-box.register{
    transform: translateX(0px);
    transition-delay: .7s;
}

.login-section .form-box.login{
    transform: translateX(0px);
    transition: transform .6s ease;
    transition-delay: 0.7s;
}
.login-section.active .form-box.login{
    transform: translateX(430px);
    transition-delay: 0s;
}


.login-section .form-box h2{
    text-align: center;
    font-size: 25px;
}

.role-select{
    font-size: 14px;
    font-weight: 500;
    margin-top: 30px;
    display: flex;
    justify-content: start;
}


.remember-password{
    font-size: 14px;
    font-weight: 500;
    margin:5 0 15px ;
    margin-top: 30px;
    margin-bottom: 30px;
    display: flex;
    justify-content: space-between;
}

.remember-password label input{
    accent-color: #fff;
    margin-right: 3px;
}

.remember-password a{
    color: #fff;
    text-decoration: none;
}
.remember-password a:hover{
    text-decoration: underline;
}

.create-account{
    font-size: 14.5px;
    text-align: center;
    margin: 25px;
}



.sta-title {
    font-size: 24px;
    font-weight: bold;
    text-align: center;
    padding: 20px 0;
}
.sta-section-title {
    font-size: 20px;
    font-weight: bold;
    padding: 10px 0;
}
.sta-content {
    padding: 5px 0;
}


.about-colunm{
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}
</style>

<style scoped>
    .clickable {
        cursor: pointer;
    }
</style>

<script setup>
import { reactive, ref } from 'vue'
import { post } from '@/net'
import { Snackbar } from '@varlet/ui'
import router from '@/router'
import '@/assets/newDialog.css'
import '@/assets/texts.css'
import GuidePanel from '../components/guide/GuidePanel.vue'

const showAbout = ref(false)
const showHelp = ref(false)
const showContact = ref(false)
const showStatement = ref(false)

const loginForm = reactive({
  idOrEmail: '',
  password: ''
})

const registerForm = reactive({
  email: '',
  password: '',
  password_repeat: ''
})

const forgetForm = reactive({
  email: ''
})

const waitForget = ref(false)
const auth = ref('user')
const accept = ref(false)

function checkLogin() {
  if (loginForm.idOrEmail === '') {
    Snackbar.warning('IDÊàñÈÇÆÁÆ±‰∏çËÉΩ‰∏∫Á©∫')
    return false
  }
  if (loginForm.password === '') {
    Snackbar.warning('ÂØÜÁ†Å‰∏çËÉΩ‰∏∫Á©∫')
    return false
  }
  if (loginForm.password.length < 6 || loginForm.password.length > 16) {
    Snackbar.warning('ÂØÜÁ†ÅÈïøÂ∫¶ÂøÖÈ°ª‰∏∫6Âà∞16‰Ωç')
    return false
  }
  return true
}

function checkMail(email) {
  const reg = /^[0-9a-zA-Z_.-]+[@][0-9a-zA-Z_.-]+([.][a-zA-Z]+){1,2}$/
  return reg.test(email)
}

function checkRegister() {
  if (!accept.value) {
    Snackbar.warning('ËØ∑ÂêåÊÑèÁî®Êà∑ÂçèËÆÆ')
    return false
  }
  if (registerForm.email === '') {
    Snackbar.warning('ÈÇÆÁÆ±‰∏çËÉΩ‰∏∫Á©∫')
    return false
  }
  if (!checkMail(registerForm.email)) {
    Snackbar.warning('ËØ∑ËæìÂÖ•Ê≠£Á°ÆÁöÑÈÇÆÁÆ±Ê†ºÂºè')
    return false
  }
  if (registerForm.password === '') {
    Snackbar.warning('ÂØÜÁ†Å‰∏çËÉΩ‰∏∫Á©∫')
    return false
  }
  if (registerForm.password.length < 6 || registerForm.password.length > 16) {
    Snackbar.warning('ÂØÜÁ†ÅÈïøÂ∫¶ÂøÖÈ°ª‰∏∫6Âà∞16‰Ωç')
    return false
  }
  if (registerForm.password !== registerForm.password_repeat) {
    Snackbar.warning('‰∏§Ê¨°ËæìÂÖ•ÁöÑÂØÜÁ†Å‰∏ç‰∏ÄËá¥')
    return false
  }
  return true
}

const login = () => {
  if (!checkLogin()) return

  if (auth.value === 'user') {
    post('/user/login',
      {
        idOrEmail: loginForm.idOrEmail,
        password: loginForm.password
      },
      (message) => {
        localStorage.setItem('token', message.token)
        localStorage.setItem('avatar', message.profilePhotoUrl)
        localStorage.setItem('auth', 'user')
        Snackbar.success('ÁôªÈôÜÊàêÂäü')
        router.push('/')
      },
      () => Snackbar.error('Áî®Êà∑‰∏çÂ≠òÂú®ÊàñÂØÜÁ†ÅÈîôËØØ')
    )
  } else {
    // admin
    post('/user/adminLogin',
      {
        account: loginForm.idOrEmail,
        password: loginForm.password
      },
      (message) => {
        localStorage.setItem('token', message.token)
        localStorage.setItem('auth', 'admin')
        Snackbar.success('ÁôªÈôÜÊàêÂäü')
        router.push('/')
      },
      () => Snackbar.error('ÁÆ°ÁêÜÂëò‰∏çÂ≠òÂú®ÊàñÂØÜÁ†ÅÈîôËØØ')
    )
  }
}

function register() {
  if (!checkRegister()) return

  post('/user/register',
    {
      email: registerForm.email,
      password: registerForm.password
    },
    () => {
      Snackbar.success('Ê≥®ÂÜåÊàêÂäü')
      // optionally prefill login
      loginForm.idOrEmail = registerForm.email
      loginForm.password = registerForm.password
      // clear fields
      registerForm.email = ''
      registerForm.password = ''
      registerForm.password_repeat = ''
      jump2Login()
    },
    () => Snackbar.error('Ê≥®ÂÜåÂ§±Ë¥•')
  )
}

const loginSecRef = ref(null)
const forgetPass = ref(false)

function jump2Register() {
  loginSecRef.value?.classList.add('active')
}

function jump2Login() {
  loginSecRef.value?.classList.remove('active')
}

function jump2Forget() {
  forgetPass.value = true
  setTimeout(() => jump2Register(), 100)
}

function jump2LoginFromForget() {
  jump2Login()
  setTimeout(() => {
    forgetPass.value = false
  }, 500)
}

function getPassword() {
  if (!checkMail(forgetForm.email)) {
    Snackbar.warning('ËØ∑ËæìÂÖ•Ê≠£Á°ÆÁöÑÈÇÆÁÆ±')
    return
  }
  waitForget.value = true
  post('/user/getPwd',
    { email: forgetForm.email },
    () => {
      Snackbar.success('ÂèëÈÄÅÊàêÂäüÔºåËØ∑Êü•ÁúãÊÇ®ÁöÑÈÇÆÁÆ±ÔºÅ')
      setTimeout(() => { waitForget.value = false }, 60000)
    },
    () => {
      Snackbar.error('ËØ•Ë¥¶Êà∑‰∏çÂ≠òÂú®ÔºÅ')
      setTimeout(() => { waitForget.value = false }, 1000)
    }
  )
}

const isLogin = ref(false)

function checkLoginState() {
  const token = localStorage.getItem('token') || ''
  if (token !== '') {
    isLogin.value = true
    setTimeout(() => {
      isLogin.value = false
      router.push('/resources/1')
    }, 2000)
  }
}

const helpEntry = [
  {
    src: 'https://learning-and-living.oss-cn-beijing.aliyuncs.com/start/login.png',
    title: 'ÁôªÂΩï',
    content: 'Â¶ÇÊûúÊÇ®Â∑≤ÁªèÊã•ÊúâÁî®Êà∑Ë¥¶Âè∑ÔºåÊàñËÄÖÂ∑≤ÁªèÊã•ÊúâÁÆ°ÁêÜÂëòË¥¶Âè∑ÔºåËØ∑ÊÇ®ÈÄâÊã©ÊÇ®ÁöÑË∫´‰ªΩÔºåÂπ∂ËæìÂÖ•Áî®Êà∑ÂêçÂíåÂØÜÁ†ÅËøõË°åÁôªÂΩï„ÄÇ'
  },
  {
    src: 'https://learning-and-living.oss-cn-beijing.aliyuncs.com/start/register.png',
    title: 'Ê≥®ÂÜå',
    content: 'Â¶ÇÊûúÊÇ®ËøòÊ≤°ÊúâÊòìË®ÄÂπ≥Âè∞Ë¥¶Âè∑ÔºåÊÇ®ÂèØ‰ª•ÁÇπÂáªÊ≥®ÂÜåÊåâÈíÆÔºåÂπ∂Êèê‰æõÊÇ®ÁöÑÈÇÆÁÆ±Âú∞ÂùÄÔºåËÆæÁΩÆÊÇ®ÁöÑÂØÜÁ†ÅÔºåÊ≥®ÂÜåÁî®Êà∑Ë¥¶Âè∑„ÄÇ'
  },
  {
    src: 'https://learning-and-living.oss-cn-beijing.aliyuncs.com/start/forget.png',
    title: 'ÊâæÂõûÂØÜÁ†Å',
    content: 'Â¶ÇÊûúÊÇ®ÂøòËÆ∞‰∫ÜÊÇ®Áî®Êà∑Ë¥¶Âè∑ÁöÑÂØÜÁ†ÅÔºåÊÇ®ÂèØ‰ª•ÁÇπÂáªÊâæÂõûÂØÜÁ†ÅÔºåËæìÂÖ•ÊÇ®ÁöÑÈÇÆÁÆ±Âú∞ÂùÄÔºåÁõ∏Â∫îË¥¶Âè∑ÁöÑÂØÜÁ†ÅÂ∞ÜË¢´ÈáçÁΩÆÔºåÂπ∂Â∞ÜÈáçÁΩÆÂêéÁöÑÂØÜÁ†ÅÂèëÈÄÅÂà∞ÊÇ®ÁöÑÈÇÆÁÆ±„ÄÇ'
  }
]

// checkLoginState()
</script>
